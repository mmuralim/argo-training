apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: deploy-nginx
spec:
  entrypoint: deploy-nginx
  
  templates:
  - name: deploy-nginx
    steps:
    - name: create-deployment
      template: apply-deployment
    - name: create-service
      template: apply-service
    - name: get-service-status
      template: check-service

  - name: apply-deployment
    container:
      image: bitnami/kubectl
      command: [sh, -c]
      args:
        - |
          cat <<EOF | kubectl apply -f - 
          apiVersion: apps/v1 kind: Deployment metadata:
            name: nginx-deployment

